<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>읽기 연습 — 日本語 学習</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="mobile-header">
    <a href="index.html" class="site-title">日本語 学習</a>
    <button class="hamburger" onclick="toggleMenu()" aria-label="menu">menu</button>
  </div>
  <div class="mobile-overlay" id="overlay" onclick="toggleMenu()"></div>

  <div class="page-wrapper">
    <aside class="sidebar" id="sidebar">
      <div class="ribbon"></div>
      <div class="sidebar-header">
        <a href="index.html" class="site-title">日本語 学習</a>
        <div class="site-subtitle">진격의 거인 원서 읽기</div>
      </div>
      <nav class="sidebar-nav">
        <a href="index.html" class="nav-link">대시보드</a>
        <a href="quiz.html" class="nav-link">かな Quiz</a>
        <a href="vocab.html" class="nav-link">단어장</a>
        <a href="grammar.html" class="nav-link">문법</a>
        <a href="reading.html" class="nav-link">읽기</a>
      </nav>
      <div class="sidebar-footer">2026 JH's Study</div>
    </aside>

    <main class="main-content">

<div class="vocab-header-bar"><a href="index.html" class="back-link">학습 대시보드</a></div>
<h1 class="page-heading">読む練習 — 읽기 연습</h1>
<p class="page-description">진격의 거인 발췌문으로 일본어 읽기 연습</p>

<div id="reading-list" class="vocab-lesson-list"></div>

<div id="reading-view" style="display:none">
  <div class="quiz-header">
    <button class="quiz-back-btn" onclick="showList()">← 지문 목록</button>
    <span id="reading-source"></span>
  </div>
  <div class="reading-passage-title" id="passage-title"></div>
  <div class="reading-lines" id="reading-lines"></div>
  <div class="reading-actions" style="margin-top:1.5rem">
    <button class="btn btn-secondary" onclick="toggleAllReadings()">읽기 전체 표시/숨기기</button>
    <button class="btn btn-secondary" onclick="toggleAllKorean()">번역 전체 표시/숨기기</button>
  </div>
  <div class="vocab-hint" style="margin-top:0.5rem">각 문장을 클릭하면 읽기/번역/단어가 표시됩니다</div>
  <div class="quiz-result-actions" style="margin-top:1.5rem">
    <button class="btn btn-secondary" onclick="showList()">지문 목록</button>
    <a href="index.html" class="btn btn-primary">대시보드로</a>
  </div>
</div>

<script>
function getProgress() { try { return JSON.parse(localStorage.getItem('jp_progress') || '{}'); } catch(e) { return {}; } }
function saveProgress(p) { localStorage.setItem('jp_progress', JSON.stringify(p)); }
function updateStreak(p) {
  if (!p.stats) p.stats = { streak_days: 0, last_study: '', total_sessions: 0 };
  const today = new Date().toISOString().slice(0,10);
  if (p.stats.last_study === today) return;
  if (p.stats.last_study) { const d = Math.floor((new Date(today) - new Date(p.stats.last_study)) / 86400000); p.stats.streak_days = d === 1 ? p.stats.streak_days + 1 : 1; } else { p.stats.streak_days = 1; }
  p.stats.last_study = today; p.stats.total_sessions++;
}

let passages = [], showAllReading = false, showAllKorean = false;

fetch('data/reading_aot.json').then(r => r.json()).then(data => { passages = data.passages; renderList(); });

function renderList() {
  const el = document.getElementById('reading-list'); el.innerHTML = '';
  passages.forEach(p => {
    const diff = {'beginner':'초급','intermediate':'중급','advanced':'고급'}[p.difficulty] || p.difficulty;
    const card = document.createElement('div'); card.className = 'vocab-lesson-card';
    card.onclick = () => openPassage(p);
    card.innerHTML = '<div class="vocab-lesson-info"><div class="vocab-lesson-title">' + p.title + ' <span style="font-size:0.8em;color:var(--text-muted)">' + p.title_ko + '</span></div><div class="vocab-lesson-meta">' + p.source + ' · ' + diff + ' · ' + p.lines.length + '문장</div></div>';
    el.appendChild(card);
  });
}

function showList() { document.getElementById('reading-list').style.display = ''; document.getElementById('reading-view').style.display = 'none'; }

function openPassage(passage) {
  document.getElementById('reading-list').style.display = 'none';
  document.getElementById('reading-view').style.display = '';
  document.getElementById('reading-source').textContent = passage.source;
  document.getElementById('passage-title').innerHTML = '<span class="reading-title-jp">' + passage.title + '</span><span class="reading-title-ko">' + passage.title_ko + '</span>';
  showAllReading = false; showAllKorean = false;
  const linesEl = document.getElementById('reading-lines'); linesEl.innerHTML = '';
  passage.lines.forEach((line, i) => {
    const div = document.createElement('div'); div.className = 'reading-line';
    div.innerHTML = '<div class="reading-jp" onclick="toggleLine(' + i + ')">' + line.japanese + '</div>' +
      '<div class="reading-reading" id="line-reading-' + i + '" style="display:none">' + line.reading + '</div>' +
      '<div class="reading-ko" id="line-ko-' + i + '" style="display:none">' + line.korean + '</div>' +
      '<div class="reading-vocab" id="line-vocab-' + i + '" style="display:none">' +
      (line.vocab || []).map(v => '<span class="reading-vocab-chip"><span class="rv-word">' + v.word + '</span><span class="rv-reading">' + v.reading + '</span><span class="rv-meaning">' + v.meaning + '</span></span>').join('') + '</div>';
    linesEl.appendChild(div);
  });

  const p = getProgress(); if (!p.reading) p.reading = {};
  p.reading[passage.id] = { read: true };
  updateStreak(p); saveProgress(p);
}

function toggleLine(i) {
  const r = document.getElementById('line-reading-' + i);
  const k = document.getElementById('line-ko-' + i);
  const v = document.getElementById('line-vocab-' + i);
  const hidden = r.style.display === 'none';
  r.style.display = hidden ? '' : 'none';
  k.style.display = hidden ? '' : 'none';
  v.style.display = hidden ? '' : 'none';
}

function toggleAllReadings() {
  showAllReading = !showAllReading;
  document.querySelectorAll('[id^="line-reading-"]').forEach(el => { el.style.display = showAllReading ? '' : 'none'; });
}

function toggleAllKorean() {
  showAllKorean = !showAllKorean;
  document.querySelectorAll('[id^="line-ko-"]').forEach(el => { el.style.display = showAllKorean ? '' : 'none'; });
  document.querySelectorAll('[id^="line-vocab-"]').forEach(el => { el.style.display = showAllKorean ? '' : 'none'; });
}
</script>

      <footer class="main-footer">2026 JH's Study</footer>
    </main>
    <div class="right-margin"></div>
  </div>
  <script>function toggleMenu() { document.getElementById('sidebar').classList.toggle('mobile-open'); document.getElementById('overlay').classList.toggle('active'); }</script>
</body>
</html>
